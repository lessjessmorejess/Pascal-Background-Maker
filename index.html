<!DOCTYPE html>
<head>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
  <style>
  #sample{
    width: 400px;
    height:400px;
    background: gray;
  }
  </style>

</head>
<body>
  <label></label>
  <select id="resolution" class="update">
     <optgroup label="iPhones">
    <option value="iPhone X">iPhone X (1125 x 2436)</option>
    <option value="iPhone 8 Plus">iPhone 8 Plus (1080 x 1920)</option>
    <option value="3x4">3x4</option>
  </select>
  <select id="position" class="update">
    <option value="0">Top Text</option>
    <option value="1">Bottom Text</option>
  </select>
  <select id="theme" class="update">
    <option value="0">Light</option>
    <option value="1">Dark</option>
  </select>
  <select id="category" class="update">Category
    <option value="New Horizons">New Horizons</option>
    <option value="New Leaf">New Leaf</option>
    <option value="User">User</option>
    <option value="Random">Random</option>
  </select>
  <input id="inp" class="update" placeholder="Enter text here"></input>
  <button onclick="Create()">Make it, maaan</button>
  <div id="imgConatiner">
    <img id="img" src="assets/pascal.png" style="display:none" crossorigin="anonymous">
    </div>
  </div>
  <canvas id="canvas" width="400" height="400"/>

</body>
  <script>
  //Declare the foundational variables
  var pascalLW = {
      "width": 2048,
      "height": 2732
    };
  var pascalImg = new Image();
      pascalImg.src = "assets/pascal.png"
  var lightImg = new Image();
      lightImg.src = "assets/light.png"
  var bubbleImg = new Image();
      bubbleImg.src = "assets/bubble.png"
  var waterImg = new Image();
      waterImg.src = "assets/water.png"


  var textColor = "#00cbda"
  var textFont  = "100px Arial" //TODO make the font size dependant on the bubble size


  var canvas = document.getElementById('canvas'),
        ctx = canvas.getContext('2d');
        canvas.crossOrigin = "Anonymous";

  //would make these jquery but need document on load
  var submissionElement  = document.getElementById("inp")
  var resolutionElement  = document.getElementById("resolution")
  var positionElement    = document.getElementById("position")
  var themeElement       = document.getElementById("theme")
  var categoryElement       = document.getElementById("category")

  //Declare default values
  var text      = "Hey maaan."
  var inputText = submissionElement.value
  var model     = resolutionElement.value
  var position  = positionElement.value
  var theme     = themeElement.value
  var category  = categoryElement.value
  function Create(){
    if (loaded !== false){


    inputText = submissionElement.value
    model     = resolutionElement.value
    position  = positionElement.value
    theme     = themeElement.value
    r         = Math.random();


    chosenQuote = Math.floor(horizons.length * r)
    /*console.log("horizons[chosenQuote] is " + horizons[chosenQuote])
    console.log("model is " + model)
    console.log(resolutions[model].width)
    console.log(resolutions[model].height)
    console.log("resolutions[model] is ")
    console.log(resolutions[model])
    console.log("position is " + position)
    console.log("theme is " + theme)*/

    console.log("inputText is '" + inputText + "'")
    if (inputText === ""){
      console.log(category)
      switch (category){
        case "New Horizons":
          text = horizons[chosenQuote];
          break;
        case "New Leaf":
          text = leaf[chosenQuote];
          break;
        case "user":
          text = user[chosenQuote];
          break;
      }

    }
    else{
      text = inputText
    }
    console.log("text is " + text)
    if(theme == "1"){
      //sample.style.color = "white"
    }
    else if(theme == "0"){
      //sample.style.color = "black"
    }
    canvas.setAttribute("width",resolutions[model].width)
    canvas.setAttribute("height",resolutions[model].height)
    var scaleLarge = resolutions[model].height/pascalLW.height
    var scaleSmall = resolutions[model].width/pascalLW.width
    console.log((resolutions[model].width/pascalLW.width) * resolutions[model].height)
    ctx.scale(scaleLarge,scaleLarge)
    ctx.clearRect(0,0,resolutions[model].width,resolutions[model].height);
    startXlarge = ( ((resolutions[model].width - pascalLW.width)/2) * scaleLarge)
    startYlarge = ( ((pascalLW.height - resolutions[model].height)/2) * scaleLarge)
    startXsmall = (((pascalLW.height - resolutions[model].height)/2) * scaleSmall)
    startYsmall = (((pascalLW.width - resolutions[model].width)/2) * scaleSmall)
    console.log(startYlarge)
    console.log(startYsmall)
    //ctx.drawImage(image, sx, sy, sWidth, sHeight, dx, dy, dWidth, dHeight);
    ctx.drawImage(waterImg, startXlarge, 0);
    ctx.drawImage(pascalImg, startXlarge, -startYsmall);
    ctx.drawImage(lightImg, startXlarge, 0);

    //reduce the drawing scale so the text bubble can fit in the window
    ctx.scale(scaleSmall,scaleSmall)
    ctx.drawImage(bubbleImg, startXsmall, -startYsmall);

    //refill text
    ctx.fillStyle = textColor;
    ctx.font = textFont
    ctx.fillText(text,40,80);
  }
  }
  var quotes = []
  var horizons = []
  var leaf = []
  var user = []
  var r
  fetch('quotes.json')
  .then(response => response.json())
  .then(data => {
    quotes = data
    horizons = quotes["Horizons"]
    leaf = quotes["Leaf"]
    user = quotes["User"]
    loaded = true;
    Create();
  });

  var resolutions = {
    "iPhone X"  :  {
      "width": 1125,
      "height": 2436
    },
    "iPhone 8 Plus"  :  {
      "width": 1080,
      "height": 1920
    }
  }
  $(document).on('input','.update',function(){
    Create()
  });
  $('button').click(function(){
    Create()
  });
  </script>
</html>
</form>
<script>





</script>
